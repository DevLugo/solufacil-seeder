// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 String             @id @default(cuid())
  name               String             @default("")
  email              String             @unique @default("")
  password           String?
  role               String?            @default("NORMAL")
  portfolioCleanups  PortfolioCleanup[] @relation("PortfolioCleanup_executedBy")
  createdAt          DateTime?          @default(now())
  from_AuditLog_user AuditLog[]         @relation("AuditLog_user")
}

model Employee {
  id                        String                @id @default(cuid())
  oldId                     String?               @unique
  routes                    Route?                @relation("Employee_routes", fields: [routesId], references: [id])
  routesId                  String?               @map("routes")
  transactions              Transaction[]         @relation("Transaction_lead")
  personalData              PersonalData?         @relation("Employee_personalData", fields: [personalDataId], references: [id])
  personalDataId            String?               @unique @map("personalData")
  loan                      Loan[]                @relation("Loan_grantor")
  commissionPayment         CommissionPayment[]   @relation("CommissionPayment_employee")
  LeadManagedLoans          Loan[]                @relation("Loan_lead")
  LeadPaymentReceivedLead   LeadPaymentReceived[] @relation("LeadPaymentReceived_lead")
  leadPaymentsReceivedAgent LeadPaymentReceived[] @relation("LeadPaymentReceived_agent")
  type                      String?

  @@index([routesId])
}

model Route {
  id                String             @id @default(cuid())
  name              String             @default("")
  employees         Employee[]         @relation("Employee_routes")
  localities        Location[]         @relation("Location_route")
  accounts          Account[]          @relation("Account_route")
  transactions      Transaction[]      @relation("Transaction_route")
  portfolioCleanups PortfolioCleanup[] @relation("PortfolioCleanup_route")
}

model Location {
  id             String        @id @default(cuid())
  name           String        @unique @default("")
  municipality   Municipality? @relation("Location_municipality", fields: [municipalityId], references: [id])
  municipalityId String?       @map("municipality")
  route          Route?        @relation("Location_route", fields: [routeId], references: [id])
  routeId        String?       @map("route")
  addresses      Address[]     @relation("Address_location")

  @@index([municipalityId])
  @@index([routeId])
}

model State {
  id             String         @id @default(cuid())
  name           String         @default("")
  municipalities Municipality[] @relation("Municipality_state")
}

model Municipality {
  id       String     @id @default(cuid())
  name     String     @default("")
  state    State?     @relation("Municipality_state", fields: [stateId], references: [id])
  stateId  String?    @map("state")
  location Location[] @relation("Location_municipality")

  @@index([stateId])
}

model Loantype {
  id                   String    @id @default(cuid())
  name                 String    @default("")
  weekDuration         Int?
  rate                 Decimal   @postgresql.Decimal(10, 2)
  loanPaymentComission Decimal?  @default("0") @postgresql.Decimal(10, 2)
  loanGrantedComission Decimal?  @default("0") @postgresql.Decimal(10, 2)
  createdAt            DateTime? @default(now())
  updatedAt            DateTime?
  loan                 Loan[]    @relation("Loan_loantype")
}

model Phone {
  id             String        @id @default(cuid())
  number         String        @default("")
  createdAt      DateTime?     @default(now())
  updatedAt      DateTime?
  personalData   PersonalData? @relation("Phone_personalData", fields: [personalDataId], references: [id])
  personalDataId String?       @map("personalData")

  @@index([personalDataId])
}

model Address {
  id             String        @id @default(cuid())
  street         String        @default("")
  exteriorNumber String        @default("")
  interiorNumber String        @default("")
  postalCode     String        @default("")
  references     String        @default("")
  location       Location?     @relation("Address_location", fields: [locationId], references: [id])
  locationId     String?       @map("location")
  personalData   PersonalData? @relation("Address_personalData", fields: [personalDataId], references: [id])
  personalDataId String?       @map("personalData")

  @@index([locationId])
  @@index([personalDataId])
}

model Borrower {
  id                String        @id @default(cuid())
  personalData      PersonalData? @relation("Borrower_personalData", fields: [personalDataId], references: [id])
  personalDataId    String?       @unique @map("personalData")
  createdAt         DateTime?     @default(now())
  updatedAt         DateTime?
  loanFinishedCount Int?          @default(0)
  loans             Loan[]        @relation("Loan_borrower")
}

model PersonalData {
  id                String    @id @default(cuid())
  fullName          String    @default("")
  clientCode        String?   @unique
  phones            Phone[]   @relation("Phone_personalData")
  addresses         Address[] @relation("Address_personalData")
  birthDate         DateTime?
  createdAt         DateTime? @default(now())
  updatedAt         DateTime?
  employee          Employee? @relation("Employee_personalData")
  borrower          Borrower? @relation("Borrower_personalData")
  loansAsCollateral Loan[]    @relation("Loan_collaterals")
}

model Loan {
  id                     String              @id @default(cuid())
  oldId                  String?             @unique
  payments               LoanPayment[]       @relation("LoanPayment_loan")
  requestedAmount        Decimal             @postgresql.Decimal(10, 2)
  amountGived            Decimal             @postgresql.Decimal(10, 2)
  loantype               Loantype?           @relation("Loan_loantype", fields: [loantypeId], references: [id])
  loantypeId             String?             @map("loantype")
  signDate               DateTime            @default(now())
  badDebtDate            DateTime?
  profitAmount           Decimal?            @postgresql.Decimal(10, 2)
  avalName               String              @default("")
  avalPhone              String              @default("")
  collaterals            PersonalData[]      @relation("Loan_collaterals")
  grantor                Employee?           @relation("Loan_grantor", fields: [grantorId], references: [id])
  grantorId              String?             @map("grantor")
  transactions           Transaction[]       @relation("Transaction_loan")
  lead                   Employee?           @relation("Loan_lead", fields: [leadId], references: [id])
  leadId                 String?             @map("lead")
  snapshotLeadId         String?
  snapshotLeadAssignedAt DateTime?
  borrower               Borrower?           @relation("Loan_borrower", fields: [borrowerId], references: [id])
  borrowerId             String?             @map("borrower")
  previousLoan           Loan?               @relation("Loan_previousLoan", fields: [previousLoanId], references: [id])
  previousLoanId         String?             @map("previousLoan")
  commissionPayment      CommissionPayment[] @relation("CommissionPayment_loan")
  totalDebtAcquired      Decimal?            @postgresql.Decimal(12, 2)
  expectedWeeklyPayment  Decimal?            @postgresql.Decimal(12, 2)
  totalPaid              Decimal?            @postgresql.Decimal(12, 2)
  pendingAmountStored    Decimal?            @postgresql.Decimal(12, 2)
  comissionAmount        Decimal?            @postgresql.Decimal(18, 4)
  finishedDate           DateTime?
  renewedDate            DateTime?
  updatedAt              DateTime?
  createdAt              DateTime?           @default(now())
  status                 String?
  snapshotRouteId        String              @default("")
  snapshotRouteName      String              @default("")
  excludedByCleanup      PortfolioCleanup?   @relation("Loan_excludedByCleanup", fields: [excludedByCleanupId], references: [id])
  excludedByCleanupId    String?             @map("excludedByCleanup")
  from_Loan_previousLoan Loan[]              @relation("Loan_previousLoan")

  @@index([loantypeId])
  @@index([grantorId])
  @@index([leadId])
  @@index([borrowerId])
  @@index([previousLoanId])
  @@index([excludedByCleanupId])
}

model LoanPayment {
  id                    String               @id @default(cuid())
  amount                Decimal?             @postgresql.Decimal(10, 2)
  comission             Decimal?             @postgresql.Decimal(18, 4)
  receivedAt            DateTime?            @default(now())
  createdAt             DateTime?            @default(now())
  updatedAt             DateTime?
  oldLoanId             String?
  loan                  Loan?                @relation("LoanPayment_loan", fields: [loanId], references: [id])
  loanId                String?              @map("loan")
  transactions          Transaction[]        @relation("Transaction_loanPayment")
  type                  String?
  leadPaymentReceived   LeadPaymentReceived? @relation("LoanPayment_leadPaymentReceived", fields: [leadPaymentReceivedId], references: [id])
  leadPaymentReceivedId String?              @map("leadPaymentReceived")
  paymentMethod         String?

  @@index([loanId])
  @@index([leadPaymentReceivedId])
}

model Transaction {
  id                   String       @id @default(cuid())
  amount               Decimal?     @postgresql.Decimal(18, 4)
  date                 DateTime?    @default(now())
  type                 String?
  incomeSource         String?
  expenseSource        String?
  description          String       @default("")
  route                Route?       @relation("Transaction_route", fields: [routeId], references: [id])
  routeId              String?      @map("route")
  lead                 Employee?    @relation("Transaction_lead", fields: [leadId], references: [id])
  leadId               String?      @map("lead")
  snapshotLeadId       String       @default("")
  sourceAccount        Account?     @relation("Transaction_sourceAccount", fields: [sourceAccountId], references: [id])
  sourceAccountId      String?      @map("sourceAccount")
  destinationAccount   Account?     @relation("Transaction_destinationAccount", fields: [destinationAccountId], references: [id])
  destinationAccountId String?      @map("destinationAccount")
  loan                 Loan?        @relation("Transaction_loan", fields: [loanId], references: [id])
  loanId               String?      @map("loan")
  loanPayment          LoanPayment? @relation("Transaction_loanPayment", fields: [loanPaymentId], references: [id])
  loanPaymentId        String?      @map("loanPayment")
  profitAmount         Decimal?     @default("0") @postgresql.Decimal(10, 2)
  returnToCapital      Decimal?     @default("0") @postgresql.Decimal(10, 2)
  createdAt            DateTime?    @default(now())
  updatedAt            DateTime?

  @@index([routeId])
  @@index([leadId])
  @@index([sourceAccountId])
  @@index([destinationAccountId])
  @@index([loanId])
  @@index([loanPaymentId])
}

model CommissionPayment {
  id         String    @id @default(cuid())
  amount     Decimal?  @postgresql.Decimal(18, 4)
  loan       Loan?     @relation("CommissionPayment_loan", fields: [loanId], references: [id])
  loanId     String?   @map("loan")
  employee   Employee? @relation("CommissionPayment_employee", fields: [employeeId], references: [id])
  employeeId String?   @map("employee")

  @@index([loanId])
  @@index([employeeId])
}

model LeadPaymentType {
  id   String  @id @default(cuid())
  type String?
}

model FalcoCompensatoryPayment {
  id                    String               @id @default(cuid())
  amount                Decimal?             @postgresql.Decimal(18, 4)
  createdAt             DateTime?            @default(now())
  updatedAt             DateTime?
  leadPaymentReceived   LeadPaymentReceived? @relation("FalcoCompensatoryPayment_leadPaymentReceived", fields: [leadPaymentReceivedId], references: [id])
  leadPaymentReceivedId String?              @map("leadPaymentReceived")

  @@index([leadPaymentReceivedId])
}

model LeadPaymentReceived {
  id                        String                     @id @default(cuid())
  expectedAmount            Decimal?                   @postgresql.Decimal(18, 4)
  paidAmount                Decimal?                   @postgresql.Decimal(18, 4)
  cashPaidAmount            Decimal?                   @postgresql.Decimal(18, 4)
  bankPaidAmount            Decimal?                   @postgresql.Decimal(18, 4)
  falcoAmount               Decimal?                   @postgresql.Decimal(18, 4)
  paymentStatus             String?
  createdAt                 DateTime?                  @default(now())
  updatedAt                 DateTime?
  agent                     Employee?                  @relation("LeadPaymentReceived_agent", fields: [agentId], references: [id])
  agentId                   String?                    @map("agent")
  lead                      Employee?                  @relation("LeadPaymentReceived_lead", fields: [leadId], references: [id])
  leadId                    String?                    @map("lead")
  falcoCompensatoryPayments FalcoCompensatoryPayment[] @relation("FalcoCompensatoryPayment_leadPaymentReceived")
  payments                  LoanPayment[]              @relation("LoanPayment_leadPaymentReceived")

  @@index([agentId])
  @@index([leadId])
}

model Account {
  id                   String        @id @default(cuid())
  name                 String        @default("")
  type                 String?
  amount               Decimal?      @postgresql.Decimal(18, 4)
  transactions         Transaction[] @relation("Transaction_sourceAccount")
  receivedTransactions Transaction[] @relation("Transaction_destinationAccount")
  route                Route?        @relation("Account_route", fields: [routeId], references: [id])
  routeId              String?       @map("route")
  updatedAt            DateTime?
  createdAt            DateTime?     @default(now())

  @@index([routeId])
}

model AuditLog {
  id             String    @id @default(cuid())
  operation      String?
  modelName      String    @default("")
  recordId       String    @default("")
  userName       String    @default("")
  userEmail      String    @default("")
  userRole       String    @default("")
  sessionId      String    @default("")
  ipAddress      String    @default("")
  userAgent      String    @default("")
  previousValues Json?
  newValues      Json?
  changedFields  Json?
  description    String    @default("")
  metadata       Json?
  createdAt      DateTime? @default(now())
  user           User?     @relation("AuditLog_user", fields: [userId], references: [id])
  userId         String?   @map("user")

  @@index([operation])
  @@index([modelName])
  @@index([recordId])
  @@index([createdAt])
  @@index([userId])
}

model PortfolioCleanup {
  id                 String    @id @default(cuid())
  name               String    @default("")
  description        String    @default("")
  cleanupDate        DateTime
  fromDate           DateTime?
  toDate             DateTime?
  excludedLoansCount Int?
  excludedAmount     Decimal?  @postgresql.Decimal(18, 4)
  route              Route?    @relation("PortfolioCleanup_route", fields: [routeId], references: [id])
  routeId            String?   @map("route")
  executedBy         User?     @relation("PortfolioCleanup_executedBy", fields: [executedById], references: [id])
  executedById       String?   @map("executedBy")
  loansExcluded      Loan[]    @relation("Loan_excludedByCleanup")
  createdAt          DateTime? @default(now())
  updatedAt          DateTime?

  @@index([routeId])
  @@index([executedById])
}
